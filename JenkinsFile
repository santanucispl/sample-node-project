pipeline{
    agent any
    environment {     
    DOCKERHUB_CREDENTIALS= credentials('dockercred')     
  } 
    stages{
        stage("clean Workspace"){
            steps{
                cleanWs()
            }
        }
        stage("git checkout"){
            steps {
                git 'https://github.com/santanucispl/sample-node-project.git'
            }
        }
        stage("docker build"){
            steps {
                sh "docker build -t shan8836/node_new_app:latest ."
            }
        }
        stage("scan image"){
            steps{
                echo 'image scanning ho gayi'
            }
        }
        stage('Login to Docker Hub') {         
            steps{                            
                    withCredentials([usernamePassword(credentialsId: 'dockercred', passwordVariable: 'dockercredPassword', usernameVariable: 'dockercredUser')]) {
                        sh "docker login -u ${env.dockercredUser} -p ${env.dockercredPassword}"
                        sh 'docker push shan8836/node_new_app:latest'
                }      
                echo 'Login Completed'                
            }           
        }  
        stage('Push Image to Docker Hub') {         
            steps{       
                 withCredentials([usernamePassword(credentialsId: 'dockercred', passwordVariable: 'dockercredPassword', usernameVariable: 'dockercredUser')]) {                     
                    sh 'sudo docker push shan8836/node_new_app:$BUILD_NUMBER'                 
                    echo 'Push Image Completed'    
                 }   
            }           
        }   

    }
}